# ะญะขะะ 4: HTTPS + Nginx Production Setup

## ๐ ะญัะฐะฟั ัััะฐะฝะพะฒะบะธ

### 1๏ธโฃ ะะตะฝะตัะธัะพะฒะฐะฝะธะต SSL ัะตััะธัะธะบะฐัะพะฒ

**ะฃะฑะตะดะธัะตัั, ััะพ ัััะฐะฝะพะฒะปะตะฝ OpenSSL:**

```powershell
# ะัะพะฒะตััะตะผ OpenSSL
openssl version

# ะัะปะธ ะฝะต ัััะฐะฝะพะฒะปะตะฝะพ:
# Windows: https://slproweb.com/products/Win32OpenSSL.html
# ะะปะธ ัััะฐะฝะพะฒะธัะต Git (ะฒะบะปััะฐะตั OpenSSL): https://git-scm.com/download/win
```

**ะะตะฝะตัะธััะตะผ ัะตััะธัะธะบะฐัั:**

```powershell
cd n:\Qr\QR-genrator
.\generate-certs.ps1
```

ะญัะพ ัะพะทะดะฐัั ะฒ ะฟะฐะฟะบะต `nginx/certs/`:
- `server.key` - ะฟัะธะฒะฐัะฝัะน ะบะปัั
- `server.crt` - ัะฐะผะพะฟะพะดะฟะธัะฐะฝะฝัะน ัะตััะธัะธะบะฐั

### 2๏ธโฃ ะััะฐะฝะพะฒะบะฐ ัะตะบััะตะณะพ Go ัะตัะฒะตัะฐ

```powershell
# ะัะปะธ ัะตัะฒะตั ะทะฐะฟััะตะฝ ะปะพะบะฐะปัะฝะพ, ะพััะฐะฝะพะฒะธัะต ะตะณะพ (Ctrl+C ะฒ ัะตัะผะธะฝะฐะปะต)
```

### 3๏ธโฃ ะะฐะฟััะบ Docker ะบะพะฝัะตะนะฝะตัะพะฒ

```powershell
cd n:\Qr\QR-genrator

# ะััะฐะฝะพะฒะปัะตะผ ััะฐััะต ะบะพะฝัะตะนะฝะตัั (ะตัะปะธ ะตััั)
docker-compose down

# ะกะพะฑะธัะฐะตะผ ะธ ะทะฐะฟััะบะฐะตะผ ะฝะพะฒัะต ะบะพะฝัะตะนะฝะตัั
docker-compose up --build
```

### 4๏ธโฃ ะัะพะฒะตัะบะฐ ััะฐัััะฐ

```powershell
# ะะพัะผะพััะตัั ะปะพะณะธ
docker-compose logs -f

# ะัะพะฒะตัะธัั ะบะพะฝัะตะนะฝะตัั
docker-compose ps

# ะัะพะฒะตัะธัั ะทะดะพัะพะฒัะต
curl http://localhost/health
```

---

## ๐ ะะพัััะฟ ะบ ัะธััะตะผะต

ะะพัะปะต ััะฟะตัะฝะพะณะพ ะทะฐะฟััะบะฐ:

### HTTPS (ัะตะบะพะผะตะฝะดัะตััั)
- **URL:** https://localhost
- **ะะพัั:** 443 (HTTPS)
- โ๏ธ ะัะฐัะทะตั ะฟะพะบะฐะถะตั ะฟัะตะดัะฟัะตะถะดะตะฝะธะต ะพ ัะฐะผะพะฟะพะดะฟะธัะฐะฝะฝะพะผ ัะตััะธัะธะบะฐัะต
  - ะะฐะถะผะธัะต "ะัะพะดะพะปะถะธัั ะฝะตัะผะพััั ะฝะฐ ะฟัะตะดัะฟัะตะถะดะตะฝะธะต" ะธะปะธ "Advanced โ Proceed"

### HTTP (ัะพะปัะบะพ ะดะปั ัะฐะทัะฐะฑะพัะบะธ)
- **URL:** http://localhost
- **ะะพัั:** 80

### API Backend (ะฒะฝัััะตะฝะฝะธะน)
- **URL:** http://api:8081 (ะฒะฝัััะธ Docker ัะตัะธ)
- ะะพัััะฟะตะฝ ัะตัะตะท Nginx ะฝะฐ https://localhost/api/*

### ะกัะฐะฝะดะฐััะฝัะต ััััะฝัะต ะดะฐะฝะฝัะต
- **ะะพะณะธะฝ:** `operator1`
- **ะะฐัะพะปั:** `password123`

---

## ๐๏ธ ะกัััะบัััะฐ Docker ัะตัะฒะธัะพะฒ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     Browser/Client                       โ
โ              https://localhost:443 (HTTPS)              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                           โ
                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ        Nginx Reverse Proxy (HTTPS Listener)              โ
โ  - ะกะปััะฐะตั 443 (HTTPS) ะธ 80 (HTTP โ 301 redirect)     โ
โ  - ะะฑัะปัะถะธะฒะฐะตั static ัะฐะนะปั (HTML, CSS, JS)            โ
โ  - ะัะพะบัะธััะตั /api/* ะฝะฐ Go backend                     โ
โ  - CORS, gzip, ะบััะธัะพะฒะฐะฝะธะต                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                           โ
                  โโโโโโโโโโดโโโโโโโโโ
                  โ                 โ
    โโโโโโโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโ
    โ   Go API Backend     โ  โ   PostgreSQL DB  โ
    โ  :8081 (HTTP)        โ  โ   :5432 (TCP)    โ
    โ  - Login             โ  โ   - Users        โ
    โ  - Item Info         โ  โ   - Items        โ
    โ  - Movements         โ  โ   - Locations    โ
    โ  - History           โ  โ   - Movements    โ
    โโโโโโโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ ะะพะฝัะธะณััะฐัะธะพะฝะฝัะต ัะฐะนะปั

### `nginx/nginx.conf`
- ะัะฝะพะฒะฝะฐั ะบะพะฝัะธะณััะฐัะธั Nginx
- ะะฐัััะพะนะบะธ worker'ะพะฒ, ะปะพะณะธัะพะฒะฐะฝะธั, gzip

### `nginx/conf.d/warehouse.conf`
- ะะพะฝัะธะณััะฐัะธั ัะฐะนัะฐ Warehouse
- SSL/TLS ะฟะฐัะฐะผะตััั
- ะะฐัััััั ะดะปั static ัะฐะนะปะพะฒ
- Proxy ะฟะฐัะฐะผะตััั ะดะปั API

### `Dockerfile`
- ะกะพะทะดะฐัั Docker ะพะฑัะฐะท Go ะฟัะธะปะพะถะตะฝะธั
- Multi-stage build ะดะปั ัะผะตะฝััะตะฝะธั ัะฐะทะผะตัะฐ

### `docker-compose.yml`
- ะัะบะตัััะธััะตั ะฒัะต ัะตัะฒะธัั (PostgreSQL, API, Nginx)
- ะะฟัะตะดะตะปัะตั volumes, networks, healthchecks

---

## ๐ง ะฃะฟัะฐะฒะปะตะฝะธะต Docker

```powershell
# ะัะพัะผะพัั ะปะพะณะพะฒ
docker-compose logs -f                 # ะัะต ัะตัะฒะธัั
docker-compose logs -f api             # ะขะพะปัะบะพ API
docker-compose logs -f nginx           # ะขะพะปัะบะพ Nginx
docker-compose logs -f postgres        # ะขะพะปัะบะพ ะะ

# ะะตัะตะทะฐะณััะทะบะฐ
docker-compose restart                 # ะัะต ัะตัะฒะธัั
docker-compose restart api             # ะขะพะปัะบะพ API

# ะััะฐะฝะพะฒะบะฐ
docker-compose down                    # ะััะฐะฝะพะฒะธัั ะธ ัะดะฐะปะธัั
docker-compose stop                    # ะขะพะปัะบะพ ะพััะฐะฝะพะฒะธัั

# ะฃะดะฐะปะตะฝะธะต ะดะฐะฝะฝัั (ะพััะพัะพะถะฝะพ!)
docker-compose down -v                 # ะฃะดะฐะปัะตั volumes (ะะ)

# ะะตัะตัะฑะพัะบะฐ
docker-compose build --no-cache        # ะะตัะตัะฑะพัะธัั ะพะฑัะฐะทั
docker-compose up --build              # ะะตัะตัะฑะพัะธัั ะธ ะทะฐะฟัััะธัั
```

---

## ๐ SSL/TLS ะดะปั Production

### Let's Encrypt (ะะตัะฟะปะฐัะฝัะน ะดะปั ะฟัะฑะปะธัะฝัั ะดะพะผะตะฝะพะฒ)

ะะปั production ั ะดะพะผะตะฝะพะผ (ะฝะฐะฟัะธะผะตั, `warehouse.example.com`):

```powershell
# 1. ะฃััะฐะฝะพะฒะธัะต Certbot
# Windows: https://certbot.eff.org/instructions

# 2. ะัะฟะพะปัะทัะนัะต ััะพั ัะบัะธะฟั ะฒะผะตััะพ generate-certs.ps1
# ะะฑะฝะพะฒะธัะต domain ะฒ nginx/conf.d/warehouse.conf

# 3. ะะฐัััะพะนัะต auto-renewal
```

### ะะพะผะผะตััะตัะบะธะต ัะตััะธัะธะบะฐัั

- ะัะฟะธัะต ัะตััะธัะธะบะฐั ั CA (DigiCert, Comodo, GlobalSign)
- ะะพะปะพะถะธัะต ะฒ `nginx/certs/`
- ะะฑะฝะพะฒะธัะต ะฟััะธ ะฒ `nginx/conf.d/warehouse.conf`

---

## ๐ ะะพะฝะธัะพัะธะฝะณ

### ะัะพะฒะตัะบะฐ ะทะดะพัะพะฒัั ัะตัะฒะธัะพะฒ

```powershell
# Nginx ะทะดะพัะพะฒ?
curl http://localhost/health

# API ะทะดะพัะพะฒ?
curl https://localhost/health

# Direct API call?
curl -H "Authorization: bearer_user1" https://localhost/api/item/item1
```

### ะะพะณะธ Docker
```powershell
# ะะพัะปะตะดะฝะธะต 100 ัััะพะบ ะปะพะณะพะฒ API
docker-compose logs --tail=100 api

# ะกะปะตะดะธัั ะทะฐ ะฝะพะฒัะผะธ ะปะพะณะฐะผะธ ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ
docker-compose logs -f
```

---

## โ๏ธ ะะฐะถะฝัะต ะผะพะผะตะฝัั

1. **ะกะฐะผะพะฟะพะดะฟะธัะฐะฝะฝัะต ัะตััะธัะธะบะฐัั** - ะดะปั ัะฐะทัะฐะฑะพัะบะธ
   - ะัะฐัะทะตั ะฟะพะบะฐะถะตั ะฟัะตะดัะฟัะตะถะดะตะฝะธะต
   - ะัะฟะพะปัะทัะนัะต ัะพะปัะบะพ ะดะปั localhost/ะฒะฝัััะตะฝะฝะตะน ัะตัะธ

2. **HTTPS ะพะฑัะทะฐัะตะปะตะฝ** ะดะปั WebRTC ะบะฐะผะตัั ะฒ production
   - ะะฐ localhost HTTP ัะฐะฑะพัะฐะตั ะดะปั ัะฐะทัะฐะฑะพัะบะธ
   - Production = HTTPS required

3. **ะะพััั**:
   - 80 (HTTP) โ ัะตะดะธัะตะบั ะฝะฐ 443 (HTTPS)
   - 443 (HTTPS) โ Nginx
   - 8081 (API) โ ัะพะปัะบะพ ะฒะฝัััะตะฝะฝัั Docker ัะตัั

4. **Firewall**:
   - ะฃะฑะตะดะธัะตัั, ััะพ ะฟะพััั 80, 443 ัะฐะทัะตัะตะฝั

5. **ะััะธัะพะฒะฐะฝะธะต**:
   - Static ัะฐะนะปั ะบััะธัััััั ะฑัะฐัะทะตัะพะผ (24 ัะฐัะฐ)
   - API ะฝะต ะบััะธััะตััั

---

## ๐ ะกะปะตะดัััะธะต ัะฐะณะธ

1. โ ะะตะฝะตัะธััะตัะต ัะตััะธัะธะบะฐัั (`.\generate-certs.ps1`)
2. โ ะะฐะฟััะบะฐะตัะต Docker (`docker-compose up --build`)
3. โ ะขะตััะธััะตัะต HTTPS (https://localhost)
4. โ ะกะบะฐะฝะธััะตัะต QR ะบะพะดั

---

## ๐ Troubleshooting

### "SSL: CERTIFICATE_VERIFY_FAILED"
- ะัะฐัะทะตั ะฝะต ะดะพะฒะตััะตั ัะฐะผะพะฟะพะดะฟะธัะฐะฝะฝะพะผั ัะตััะธัะธะบะฐัั
- ะญัะพ ะฝะพัะผะฐะปัะฝะพ ะดะปั ัะฐะทัะฐะฑะพัะบะธ
- ะะฐะถะผะธัะต "Proceed" ะธะปะธ ะธัะฟะพะปัะทัะนัะต production ัะตััะธัะธะบะฐั

### "Connection refused"
- ะัะพะฒะตัััะต, ะทะฐะฟััะตะฝั ะปะธ Docker ะบะพะฝัะตะนะฝะตัั: `docker-compose ps`
- ะัะพะฒะตัััะต ะปะพะณะธ: `docker-compose logs`

### "502 Bad Gateway"
- API ะบะพะฝัะตะนะฝะตั ะผะพะถะตั ะฝะต ะทะฐะฟัััะธัััั
- ะัะพะฒะตัััะต ะปะพะณะธ API: `docker-compose logs api`
- ะัะพะฒะตัััะต, ััะพ ะะ ะทะดะพัะพะฒะฐ: `docker-compose logs postgres`

### "Cannot find module"
- Go ะทะฐะฒะธัะธะผะพััะธ ะฝะต ัะบะฐัะฐะฝั
- ะะฐะฟัััะธัะต: `docker-compose build --no-cache`

---

**ะกะธััะตะผะฐ ะณะพัะพะฒะฐ ะบ production! ๐**

ะะปั ะฒะพะฟัะพัะพะฒ ะธะปะธ ะฟัะพะฑะปะตะผ - ัะผะพััะธัะต troubleshooting ัะตะบัะธั ะฒััะต.
